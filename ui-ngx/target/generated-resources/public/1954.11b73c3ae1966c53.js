"use strict";(self.webpackChunkthingsboard=self.webpackChunkthingsboard||[]).push([[1954],{71954:(_,R,M)=>{M.r(R),M.d(R,{CanvasDigitalGauge:()=>C,Drawings:()=>S});var k=M(21647),c=M(93387),T=M(9351),Y=M(70970),E=k.GenericOptions,L=k.BaseGauge;const D={...E,gaugeType:"arc",gaugeWithScale:.75,dashThickness:0,roundedLineCap:!1,gaugeColor:"#777",levelColors:["blue"],symbol:"",hideValue:!1,hideMinMax:!1,fontTitle:"Roboto",fontValue:"Roboto",fontMinMaxSize:10,fontMinMaxStyle:"normal",fontMinMaxWeight:"500",colorMinMax:"#eee",fontMinMax:"Roboto",fontLabelSize:8,fontLabelStyle:"normal",fontLabelWeight:"500",colorLabel:"#eee",fontLabel:"Roboto",neonGlowBrightness:0,colorTicks:"gray",tickWidth:4,ticks:[],isMobile:!1};L.initialize("CanvasDigitalGauge",D);class S{static font(e,t,r){return e["font"+t+"Style"]+" "+e["font"+t+"Weight"]+" "+e["font"+t+"Size"]*r+"px "+e["font"+t]}static normalizedValue(e){const t=e.value,r=e.minValue,i=e.maxValue,n=.01*(i-r);return{normal:t<r?r:t>i?i:t,indented:t<r?r-n:t>i?i+n:t}}static verifyError(e){if(!(e instanceof DOMException&&2152923147===e.result))throw e}}class C extends L{constructor(e){e={...D,...e||{}},super(C.configure(e)),this.initValueClone()}static configure(e){e.value>e.maxValue&&(e.value=e.maxValue),e.value<e.minValue&&(e.value=e.minValue),"donut"===e.gaugeType&&((0,T.nu)(e.donutStartAngle)||(e.donutStartAngle=1.5*Math.PI),(0,T.nu)(e.donutEndAngle)||(e.donutEndAngle=e.donutStartAngle+2*Math.PI));const t=e.levelColors.length,r=(0,T.HD)(e.levelColors[0]),i=t>1?1/(t-1):1;e.colorsRange=[],e.neonGlowBrightness&&(e.neonColorsRange=[]);for(let n=0;n<e.levelColors.length;n++){const a=e.levelColors[n];if(null!==a){let s;s=r?i*n:C.normalizeValue(a.value,e.minValue,e.maxValue);let h=(0,c.Z)(r?a:a.color);e.colorsRange.push({pct:s,color:h.toRgb(),rgbString:h.toRgbString()}),e.neonGlowBrightness&&(h=(0,c.Z)(r?a:a.color).brighten(e.neonGlowBrightness),e.neonColorsRange.push({pct:s,color:h.toRgb(),rgbString:h.toRgbString()}))}}e.ticksValue=[];for(const n of e.ticks)null!==n&&e.ticksValue.push(C.normalizeValue(n,e.minValue,e.maxValue));return e.neonGlowBrightness&&(e.neonColorTitle=(0,c.Z)(e.colorTitle).brighten(e.neonGlowBrightness).toHexString(),e.neonColorLabel=(0,c.Z)(e.colorLabel).brighten(e.neonGlowBrightness).toHexString(),e.neonColorValue=(0,c.Z)(e.colorValue).brighten(e.neonGlowBrightness).toHexString(),e.neonColorMinMax=(0,c.Z)(e.colorMinMax).brighten(e.neonGlowBrightness).toHexString()),e}static normalizeValue(e,t,r){const i=(e-t)/(r-t);return i<=0?0:i>=1?1:i}initValueClone(){const e=this.canvas;this.elementValueClone=e.element.cloneNode(!0),this.contextValueClone=this.elementValueClone.getContext("2d"),this.elementValueClone.initialized=!1,this.contextValueClone.translate(e.drawX,e.drawY),this.contextValueClone.save(),this.elementProgressClone=e.element.cloneNode(!0),this.contextProgressClone=this.elementProgressClone.getContext("2d"),this.elementProgressClone.initialized=!1,this.contextProgressClone.translate(e.drawX,e.drawY),this.contextProgressClone.save()}destroy(){this.contextValueClone=null,this.elementValueClone=null,this.contextProgressClone=null,this.elementProgressClone=null,super.destroy()}update(e){this.canvas.onRedraw=null;const t=super.update(e);return this.initValueClone(),this.canvas.onRedraw=this.draw.bind(this),this.draw(),t}set timestamp(e){this.options.timestamp=e,this.draw()}get timestamp(){return this.options.timestamp}draw(){try{const e=this.canvas;if(!e.drawWidth||!e.drawHeight)return this;const[t,r,i,n]=[-e.drawX,-e.drawY,e.drawWidth,e.drawHeight],a=this.options,s=e.elementClone;if(!s.initialized){const u=e.contextClone;u.clearRect(t,r,i,n),u.save();const g=e.context;g.barDimensions=function H(l,e,t,r,i,n){l.barDimensions={baseX:t,baseY:r,width:i,height:n};const a=l.barDimensions;let s=1;"horizontalBar"===e.gaugeType?s=""===e.title?2.5:2:"verticalBar"===e.gaugeType?s=e.hideMinMax?.35:.5:"arc"===e.gaugeType&&(s=1.5),i/n>s?(a.width=n*s,a.height=n):(a.width=i,a.height=i/s),a.origBaseX=a.baseX,a.origBaseY=a.baseY,a.baseX+=(i-a.width)/2,a.baseY+=(n-a.height)/2,"donut"===e.gaugeType?a.fontSizeFactor=Math.max(a.width,a.height)/125:"verticalBar"===e.gaugeType||"arc"===e.gaugeType&&""===e.title?a.fontSizeFactor=Math.max(a.width,a.height)/150:a.fontSizeFactor=Math.max(a.width,a.height)/200;const f=e.gaugeWidthScale;if(e.neonGlowBrightness&&(e.fontTitleHeight=w(e,"Title",a.fontSizeFactor),e.fontLabelHeight=w(e,"Label",a.fontSizeFactor),e.fontValueHeight=w(e,"Value",a.fontSizeFactor),e.fontMinMaxHeight=w(e,"MinMax",a.fontSizeFactor)),"donut"===e.gaugeType){if(a.Ro=a.width/2-a.width/20,a.Cy=a.baseY+a.height/2,e.title&&"string"==typeof e.title&&e.title.length>0){let o=w(e,"Title",a.fontSizeFactor).height;o+=2*a.fontSizeFactor,a.titleY=a.baseY+o,o+=2*a.fontSizeFactor,a.Cy+=o/2,a.Ro-=o/2}a.Ri=a.Ro-a.width/6.666666666666667*f*1.2,a.Cx=a.baseX+a.width/2}else"arc"===e.gaugeType?(e.title&&"string"==typeof e.title&&e.title.length>0?(a.Ro=a.width/2-a.width/7,a.Ri=a.Ro-a.width/6.666666666666667*f):(a.Ro=a.width/2-4*a.fontSizeFactor,a.Ri=a.Ro-a.width/6.666666666666667*f*1.2),a.Cx=a.baseX+a.width/2,a.Cy=a.baseY+a.height/1.25):"verticalBar"===e.gaugeType?(a.Ro=a.width/2-a.width/10,a.Ri=a.Ro-a.width/6.666666666666667*f*(e.hideMinMax?4:2.5)):(a.Ro=a.width/2-a.width/10,a.Ri=a.Ro-a.width/6.666666666666667*f);if(a.strokeWidth=a.Ro-a.Ri,a.Rm=a.Ri+.5*a.strokeWidth,a.fontValueBaseline="alphabetic",a.fontMinMaxBaseline="alphabetic",a.fontMinMaxAlign="center","donut"===e.gaugeType)if(a.fontValueBaseline="middle",e.showUnitTitle||e.showTimestamp){const o=w(e,"Value",a.fontSizeFactor).height,g=o+w(e,"Label",a.fontSizeFactor).height;a.labelY=a.Cy+g/2,a.timeseriesLabelY=V(e,a.labelY,a.fontSizeFactor),a.valueY=a.Cy-g/2+o/2}else a.valueY=a.Cy;else if("arc"===e.gaugeType)a.titleY=a.Cy-a.Ro-12*a.fontSizeFactor,a.valueY=a.Cy,a.labelY=a.Cy+(8+e.fontLabelSize)*a.fontSizeFactor,a.timeseriesLabelY=V(e,a.labelY,a.fontSizeFactor),a.minY=a.maxY=a.labelY,e.roundedLineCap&&(a.minY+=a.strokeWidth/2,a.maxY+=a.strokeWidth/2),a.minX=a.Cx-a.Rm,a.maxX=a.Cx+a.Rm;else if("horizontalBar"===e.gaugeType)if(a.titleY=a.baseY+4*a.fontSizeFactor+(""===e.title?0:e.fontTitleSize*a.fontSizeFactor),a.titleBottom=a.titleY+(""===e.title?0:4)*a.fontSizeFactor,a.valueY=a.titleBottom+(e.hideValue?0:e.fontValueSize*a.fontSizeFactor),a.barTop=a.valueY+8*a.fontSizeFactor,a.barBottom=a.barTop+a.strokeWidth,!e.hideMinMax||e.showUnitTitle||e.showTimestamp){l.font=S.font(e,"MinMax",a.fontSizeFactor);const o=l.measureText(e.minValue+"").width,u=l.measureText(e.maxValue+"").width,g=Math.max(o,u);a.minX=a.origBaseX+g/2+e.fontMinMaxSize/3*a.fontSizeFactor,a.maxX=a.origBaseX+i+-g/2-e.fontMinMaxSize/3*a.fontSizeFactor,a.barLeft=a.minX,a.barRight=a.maxX,a.labelY=a.barBottom+(8+e.fontLabelSize)*a.fontSizeFactor,a.timeseriesLabelY=V(e,a.labelY,a.fontSizeFactor),a.minY=a.maxY=a.labelY}else a.labelY=a.barBottom,a.timeseriesLabelY=V(e,a.labelY,a.fontSizeFactor),a.barLeft=a.origBaseX+e.fontMinMaxSize/3*a.fontSizeFactor,a.barRight=a.origBaseX+i+-e.fontMinMaxSize/3*a.fontSizeFactor;else"verticalBar"===e.gaugeType&&(a.titleY=a.baseY+((""===e.title?0:e.fontTitleSize)+8)*a.fontSizeFactor,a.titleBottom=a.titleY+(""===e.title?0:4)*a.fontSizeFactor,a.valueY=a.titleBottom+(e.hideValue?0:e.fontValueSize*a.fontSizeFactor),a.barTop=a.valueY+8*a.fontSizeFactor,a.labelY=a.baseY+a.height,a.timeseriesLabelY=V(e,a.labelY,a.fontSizeFactor),e.showUnitTitle||e.showTimestamp?a.barBottom=a.labelY-e.fontLabelSize*a.fontSizeFactor:a.barBottom=a.labelY,a.minX=a.maxX=a.baseX+a.width/2+a.strokeWidth/2+e.fontMinMaxSize/3*a.fontSizeFactor,a.minY=a.barBottom,a.maxY=a.barTop,a.fontMinMaxBaseline="middle",a.fontMinMaxAlign="left");if(e.dashThickness){let o;"donut"===e.gaugeType?o=Math.PI*a.Rm*2:"arc"===e.gaugeType?o=Math.PI*a.Rm:"horizontalBar"===e.gaugeType?o=a.barRight-a.barLeft:"verticalBar"===e.gaugeType&&(o=a.barBottom-a.barTop);let u=Math.floor(o/(e.dashThickness*a.fontSizeFactor));u="donut"===e.gaugeType?(1|u)-1:u-1|1,a.dashLength=Math.ceil(o/u)}return a}(u,a,t,r,i,n),this.contextValueClone.barDimensions=g.barDimensions,this.contextProgressClone.barDimensions=g.barDimensions,function O(l,e){const{barLeft:t,barRight:r,barTop:i,barBottom:n,width:a,baseX:s,strokeWidth:h}=l.barDimensions;l.barDimensions.dashLength&&l.setLineDash([l.barDimensions.dashLength]),l.beginPath(),l.strokeStyle=e.gaugeColor,l.lineWidth=h,e.roundedLineCap&&(l.lineCap="round"),"donut"===e.gaugeType?(l.arc(l.barDimensions.Cx,l.barDimensions.Cy,l.barDimensions.Rm,e.donutStartAngle,e.donutEndAngle),l.stroke()):"arc"===e.gaugeType?(l.arc(l.barDimensions.Cx,l.barDimensions.Cy,l.barDimensions.Rm,Math.PI,2*Math.PI),l.stroke()):"horizontalBar"===e.gaugeType?(l.moveTo(t,i+h/2),l.lineTo(r,i+h/2),l.stroke()):"verticalBar"===e.gaugeType&&(l.moveTo(s+a/2,n),l.lineTo(s+a/2,i),l.stroke())}(u,a),function U(l,e){if(!e.title||"string"!=typeof e.title)return;const{titleY:t,width:r,baseX:i,fontSizeFactor:n}=l.barDimensions,a=Math.round(i+r/2),s=t;l.save(),l.textAlign="center",l.font=S.font(e,"Title",n),l.lineWidth=0,B(l,e,"Title",e.title.toUpperCase(),a,s),l.restore()}(u,a),a.showUnitTitle&&F(u,a,a.unitTitle,"labelY"),function Z(l,e){if(e.hideMinMax||"donut"===e.gaugeType)return;const{minY:t,maxY:r,minX:i,maxX:n,fontSizeFactor:a,fontMinMaxAlign:s,fontMinMaxBaseline:h}=l.barDimensions;l.save(),l.textAlign=s,l.textBaseline=h,l.font=S.font(e,"MinMax",a),l.lineWidth=0,B(l,e,"MinMax",e.minValue+"",i,t),B(l,e,"MinMax",e.maxValue+"",n,r),l.restore()}(u,a),s.initialized=!0}let h=!1;if(!this.elementValueClone.initialized||(0,T.$K)(this._value)&&this.elementValueClone.renderedValue!==this._value||a.showTimestamp&&this.elementValueClone.renderedTimestamp!==this.timestamp){(0,T.$K)(this._value)&&(this.elementValueClone.renderedValue=this._value),(0,T.o8)(this.elementValueClone.renderedValue)&&(this.elementValueClone.renderedValue=this.value);const u=this.contextValueClone;u.clearRect(t,r,i,n),u.drawImage(e.elementClone,t,r,i,n),function K(l,e,t){if(e.hideValue)return;const{valueY:r,baseX:i,width:n,fontSizeFactor:a,fontValueBaseline:s}=l.barDimensions,h=Math.round(i+n/2),f=r;let o=e.valueText||(0,T.fX)(t,e.valueDec);o+=e.symbol,l.save(),l.textAlign="center",l.textBaseline=s,l.font=S.font(e,"Value",a),l.lineWidth=0,B(l,e,"Value",o,h,f),l.restore()}(u,a,this.elementValueClone.renderedValue),a.showTimestamp&&(F(u,a,a.labelTimestamp,"timeseriesLabelY"),this.elementValueClone.renderedTimestamp=this.timestamp),this.elementValueClone.initialized=!0,h=!0}const f=(S.normalizedValue(a).normal-a.minValue)/(a.maxValue-a.minValue),o=f.toFixed(3);if(!this.elementProgressClone.initialized||this.elementProgressClone.renderedProgress!==o||h){const u=this.contextProgressClone;u.clearRect(t,r,i,n),u.drawImage(this.elementValueClone,t,r,i,n),Number(o)>0&&function N(l,e,t){let r;l.save(),e.neonGlowBrightness?l.currentColor=r=P(t,e.neonColorsRange):l.currentColor=l.strokeStyle=P(t,e.colorsRange);const{barLeft:i,barRight:n,barTop:a,baseX:s,width:h,barBottom:f,Cx:o,Cy:u,Rm:g,Ro:m,Ri:b,strokeWidth:d}=l.barDimensions;l.barDimensions.dashLength&&l.setLineDash([l.barDimensions.dashLength]),l.lineWidth=d,e.roundedLineCap?l.lineCap="round":l.lineCap="butt","donut"===e.gaugeType?(e.neonGlowBrightness&&(l.strokeStyle=r),l.beginPath(),l.arc(o,u,g,e.donutStartAngle,e.donutStartAngle+(e.donutEndAngle-e.donutStartAngle)*t),l.stroke(),e.neonGlowBrightness&&!e.isMobile&&W(l,o,u,b,g,m,r,t,!0,e.donutStartAngle,e.donutEndAngle),G(l,e.ticksValue,o,u,b,g,m,e.donutStartAngle,e.donutEndAngle-e.donutStartAngle,e.colorTicks,e.tickWidth)):"arc"===e.gaugeType?(e.neonGlowBrightness&&(l.strokeStyle=r),l.beginPath(),l.arc(o,u,g,Math.PI,Math.PI+Math.PI*t),l.stroke(),e.neonGlowBrightness&&!e.isMobile&&W(l,o,u,b,g,m,r,t,!1),G(l,e.ticksValue,o,u,b,g,m,Math.PI,Math.PI,e.colorTicks,e.tickWidth)):"horizontalBar"===e.gaugeType?(e.neonGlowBrightness&&(l.strokeStyle=r),l.beginPath(),l.moveTo(i,a+d/2),l.lineTo(i+(n-i)*t,a+d/2),l.stroke(),e.neonGlowBrightness&&!e.isMobile&&A(l,i,a+d/2,i+(n-i)*t,a+d/2,r,d,!1),X(l,e.ticksValue,i,a,n-i,d,!1,e.colorTicks,e.tickWidth)):"verticalBar"===e.gaugeType&&(e.neonGlowBrightness&&(l.strokeStyle=r),l.beginPath(),l.moveTo(s+h/2,f),l.lineTo(s+h/2,f-(f-a)*t),l.stroke(),e.neonGlowBrightness&&!e.isMobile&&A(l,s+h/2,f,s+h/2,f-(f-a)*t,r,d,!0),X(l,e.ticksValue,s+h/2,a,a-f,d,!0,e.colorTicks,e.tickWidth)),l.restore()}(u,a,f),this.elementProgressClone.initialized=!0,this.elementProgressClone.renderedProgress=o}this.canvas.commit(),e.context.clearRect(t,r,i,n),e.context.drawImage(this.elementProgressClone,t,r,i,n),super.draw()}catch(e){S.verifyError(e)}return this}getValueColor(){if(this.contextProgressClone){let e=this.contextProgressClone.currentColor;const t=this.options;if(!e){const r=(S.normalizedValue(t).normal-t.minValue)/(t.maxValue-t.minValue);e=t.neonGlowBrightness?P(r,t.neonColorsRange):P(r,t.colorsRange)}return e}return"#000"}}function V(l,e,t){return l.showUnitTitle?e+l.fontLabelSize*t*1.2:e}function w(l,e,t){const r="font-style:"+l["font"+e+"Style"]+";font-weight:"+l["font"+e+"Weight"]+";font-size:"+l["font"+e+"Size"]*t+"px;font-family:"+l["font"+e];let i=C.heightCache[r];if(!i){const n={fontFamily:l["font"+e],fontSize:l["font"+e+"Size"]*t+"px",fontWeight:l["font"+e+"Weight"],fontStyle:l["font"+e+"Style"]},a=Y("<span>Hg</span>").css(n),s=Y('<div style="display: inline-block; width: 1px; height: 0;"></div>'),h=Y("<div></div>");h.append(a,s),Y("body").append(h);try{i={},s.css({verticalAlign:"baseline"}),i.ascent=s.offset().top-a.offset().top,s.css({verticalAlign:"bottom"}),i.height=s.offset().top-a.offset().top,i.descent=i.height-i.ascent}finally{h.remove()}C.heightCache[r]=i}return i}function B(l,e,t,r,i,n){l.fillStyle=e[(e.neonGlowBrightness?"neonColor":"color")+t],l.fillText(r,i,n)}function F(l,e,t,r){if(!t||""===t)return;const{baseX:i,width:n,fontSizeFactor:a}=l.barDimensions,s=Math.round(i+n/2),h=l.barDimensions[r];l.save(),l.textAlign="center",l.font=S.font(e,"Label",a),l.lineWidth=0,B(l,e,"Label",t,s,h),l.restore()}function P(l,e){if(0===l||1===e.length)return e[0].rgbString;for(let t=1;t<e.length;t++)if(l<=e[t].pct){const r=e[t-1],i=e[t],n=i.pct-r.pct,a=(l-r.pct)/n,s=1-a,h=a;return(0,c.Z)({r:Math.floor(r.color.r*s+i.color.r*h),g:Math.floor(r.color.g*s+i.color.g*h),b:Math.floor(r.color.b*s+i.color.b*h)}).toRgbString()}return e[e.length-1].rgbString}function W(l,e,t,r,i,n,a,s,h,f,o){l.setLineDash([]);const u=n-r,g=.55,m=u*g;l.lineWidth=u+m;const b=g/3.1,d=l.createRadialGradient(e,t,r-m/2,e,t,n+m/2),y=(0,c.Z)(a).setAlpha(.5).toRgbString(),z=(0,c.Z)(a).setAlpha(0).toRgbString();d.addColorStop(0,z),d.addColorStop(b,y),d.addColorStop(1-b,y),d.addColorStop(1,z),l.strokeStyle=d,l.beginPath();const v=.01*Math.PI;h?l.arc(e,t,i,f-v,f+(o-f)*s+v):l.arc(e,t,i,Math.PI-v,Math.PI+Math.PI*s+v),l.stroke()}function A(l,e,t,r,i,n,a,s){l.setLineDash([]);const h=.55,f=a*h;l.lineWidth=a+f;const o=h/3.1,u=s?e-l.lineWidth/2:0,g=s?0:t-l.lineWidth/2,m=s?e+l.lineWidth/2:0,b=s?0:t+l.lineWidth/2,d=l.createLinearGradient(u,g,m,b),y=(0,c.Z)(n).setAlpha(.5).toRgbString(),z=(0,c.Z)(n).setAlpha(0).toRgbString();d.addColorStop(0,z),d.addColorStop(o,y),d.addColorStop(1-o,y),d.addColorStop(1,z),l.strokeStyle=d;const v=s?0:.05*l.lineWidth,I=s?.05*l.lineWidth:0;l.beginPath(),l.moveTo(e-v,t+I),l.lineTo(r+v,i-I),l.stroke()}function G(l,e,t,r,i,n,a,s,h,f,o){if(!e.length)return;const u=a-i;l.beginPath(),l.lineWidth=o,l.strokeStyle=f;for(const g of e){const m=s+g*h,b=t+(i+u)*Math.cos(m),d=r+(i+u)*Math.sin(m),y=t+i*Math.cos(m),z=r+i*Math.sin(m);l.moveTo(b,d),l.lineTo(y,z)}l.stroke()}function X(l,e,t,r,i,n,a,s,h){if(e.length){l.beginPath(),l.lineWidth=h,l.strokeStyle=s;for(const f of e){const o=f*i;a?(l.moveTo(t-n/2,r+o-i),l.lineTo(t+n/2,r+o-i)):(l.moveTo(t+o,r),l.lineTo(t+o,r+n))}l.stroke()}}C.heightCache={}}}]);